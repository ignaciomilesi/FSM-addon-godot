[gd_scene load_steps=4 format=3 uid="uid://dfx0yd8i8xlh3"]

[ext_resource type="Texture2D" uid="uid://cgxvjenr7gnxe" path="res://addons/FSM/utils/Conector Simple.png" id="1_i743a"]

[sub_resource type="GDScript" id="GDScript_pg5ax"]
script/source = "@tool
extends Line2D

@export var EstadoInicio : GraphNode
@export var EstadoFin : GraphNode

func _ready():
	var color =  Color.from_hsv(randf(), 0.5, 1)
	default_color = color
	$Label.self_modulate = color

	
func _process(_delta):
	if EstadoInicio == null or EstadoFin == null:
		return
		
	var posicionInicialConector : Vector2 = EstadoInicio.position + EstadoInicio.size / 2
	var posicionFinalConector : Vector2 =  EstadoFin.position + EstadoFin.size /2
	
	set_point_position(0, posicionInicialConector)
	set_point_position(1, posicionFinalConector)
	
	# Acomodo el label 
	$Label.position = (posicionInicialConector + 
	1 * (posicionFinalConector - posicionInicialConector) / 5)
	
	# acomodo el label para que no quede sobre la linea
	var anguloConector = (posicionFinalConector - posicionInicialConector).angle()
	
	$Label.rotation = anguloConector
	if anguloConector < -PI/2 or anguloConector > PI/2:
		$Label.rotation += PI
		$Label.position += ((posicionFinalConector - posicionInicialConector)
			.normalized() * 100)
	else:
		$Label.position += ((posicionFinalConector - posicionInicialConector)
			.normalized().rotated(-PI/2) * 25)

func set_label_condicion(condicion):
	$Label.text = condicion
"

[sub_resource type="LabelSettings" id="LabelSettings_j2ki3"]
font_size = 10

[node name="Conector" type="Line2D"]
points = PackedVector2Array(0, 0, 400, 0)
width = 24.0
default_color = Color(1, 0.5, 0.86714, 1)
texture = ExtResource("1_i743a")
texture_mode = 2
round_precision = 1
script = SubResource("GDScript_pg5ax")
metadata/_edit_lock_ = true

[node name="Label" type="Label" parent="."]
self_modulate = Color(1, 0.5, 0.86714, 1)
clip_contents = true
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_right = 7.0
offset_bottom = 14.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4
text = "A"
label_settings = SubResource("LabelSettings_j2ki3")
horizontal_alignment = 1
vertical_alignment = 1

[node name="ColorRect" type="ColorRect" parent="Label"]
show_behind_parent = true
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0.2, 0.2, 0.2, 1)
metadata/_edit_lock_ = true
